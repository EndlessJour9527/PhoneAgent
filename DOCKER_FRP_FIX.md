# Docker FRP é…ç½®ä¿®å¤æŠ¥å‘Š

## ä¿®å¤çš„é—®é¢˜

### 1. Docker ç«¯å£æ˜ å°„é”™è¯¯ âœ… å·²ä¿®å¤

**é—®é¢˜:** docker-compose.yml è¢«é”™è¯¯æ”¹æˆ `7001:7001`

**ä¿®å¤å:**
```yaml
ports:
  - "0.0.0.0:7001:7000"  # å¤–éƒ¨7001 â†’ å®¹å™¨å†…éƒ¨7000
```

**åŸå› :** macOS Control Center å ç”¨ 7000ï¼Œæ‰€ä»¥å¤–éƒ¨å¿…é¡»ç”¨ 7001

### 2. å¥åº·æ£€æŸ¥è„šæœ¬ç«¯å£é”™è¯¯ âœ… å·²ä¿®å¤

**é—®é¢˜:** docker-healthcheck.sh æ£€æŸ¥å®¹å™¨å†…éƒ¨çš„ 7000

**ä¿®å¤å:**
```bash
if nc -z -w 1 localhost 7001 > /dev/null 2>&1; then
```

ç°åœ¨æ£€æŸ¥å®¿ä¸»æœºçš„ 7001 ç«¯å£ï¼ˆDocker æ˜ å°„çš„å¤–éƒ¨ç«¯å£ï¼‰

### 3. å¯åŠ¨è„šæœ¬æ˜¾ç¤ºä¿¡æ¯é”™è¯¯ âœ… å·²ä¿®å¤

**é—®é¢˜:** docker-entrypoint.sh æ˜¾ç¤º `FRP æœåŠ¡å™¨: ${LOCAL_IP}:7000`

**ä¿®å¤å:**
```bash
echo "   FRP æœåŠ¡å™¨:   ${LOCAL_IP}:7001  (å®¹å™¨å†…éƒ¨:7000)"
```

## å½“å‰é…ç½®éªŒè¯

### Docker æœåŠ¡çŠ¶æ€
```
âœ… å®¹å™¨å·²é‡å¯
âœ… ç«¯å£æ˜ å°„: 7001:7000 
âœ… FRP æœåŠ¡å™¨ç›‘å¬: å®¹å™¨å†…éƒ¨ 7000
âœ… å¤–éƒ¨å¯è®¿é—®ç«¯å£: 7001
```

### ç«¯å£ç›‘å¬çŠ¶æ€
```
tcp46  *.7001  LISTEN  âœ… Docker å¤–éƒ¨ç«¯å£
tcp6   *.7000  LISTEN  âœ… macOS Control Center
tcp4   *.7000  LISTEN  âœ… macOS Control Center
```

### FRP æœåŠ¡å™¨é…ç½®
```ini
bind_port = 7000     âœ… å®¹å™¨å†…éƒ¨æ­£ç¡®
token = 2024         âš ï¸ æ³¨æ„: æ‚¨è®¾å¤‡å¡«çš„æ˜¯ 2014!
allow_ports = 6100-6199
```

## ğŸš¨ å‘ç°çš„æ–°é—®é¢˜: Token ä¸åŒ¹é…

### æœåŠ¡å™¨é…ç½®
- Token: **2024**
- æ¥æº: `.env` æ–‡ä»¶ä¸­çš„ `FRP_TOKEN=2024`

### æ‚¨çš„è®¾å¤‡é…ç½®
- IP: 10.91.1.207 âœ…
- Token: **2014** âŒ é”™è¯¯ï¼
- FRP Port: 6104 âœ…

### ä¿®å¤æ–¹æ³•

**é€‰é¡¹1: ä¿®æ”¹è®¾å¤‡é…ç½®ï¼ˆæ¨èï¼‰**
```
åœ¨è®¾å¤‡ä¸Šé‡æ–°å¡«å†™é…ç½®:
- æœåŠ¡å™¨ IP: 10.91.1.207
- FRP Token: 2024  â† æ”¹ä¸º 2024
- FRP Remote Port: 6104
- è¿æ¥æ–¹å¼: é€‰æ‹©åˆé€‚çš„æ–¹å¼
```

**é€‰é¡¹2: ä¿®æ”¹æœåŠ¡å™¨é…ç½®**
```bash
# ä¿®æ”¹ .env æ–‡ä»¶
echo "FRP_TOKEN=2014" >> .env

# é‡å¯ Docker
docker compose down
docker compose up -d
```

## å®Œæ•´çš„è®¾å¤‡é…ç½®æŒ‡å—

### Android è®¾å¤‡åº”å¡«å†™çš„é…ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PhoneAgent è®¾å¤‡é…ç½®                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœåŠ¡å™¨ IP:      10.91.1.207                 â”‚
â”‚ FRP Token:      2024  âš ï¸ å¿…é¡»ä¸æœåŠ¡å™¨ä¸€è‡´    â”‚
â”‚ FRP æœåŠ¡å™¨ç«¯å£: è‡ªåŠ¨ä½¿ç”¨ 7001               â”‚
â”‚ FRP è¿œç¨‹ç«¯å£:   6104 (æˆ–å…¶ä»–6100-6199èŒƒå›´)  â”‚
â”‚ è¿æ¥æ–¹å¼:       ç›´è¿IP / åŸŸåä»£ç†           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”Ÿæˆçš„ frpc.ini åº”è¯¥æ˜¯

```ini
[common]
server_addr = 10.91.1.207
server_port = 7001  â† å¿…é¡»æ˜¯ 7001ï¼Œä¸æ˜¯ 7000
token = 2024        â† å¿…é¡»æ˜¯ 2024ï¼Œä¸æ˜¯ 2014

[Android_A142_adb]
type = tcp
local_ip = 127.0.0.1
local_port = 5555
remote_port = 6104
```

## ç½‘ç»œæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ macOS Host (10.91.1.207)                                â”‚
â”‚                                                         â”‚
â”‚ Port 7000: macOS Control Center âŒ å·²å ç”¨               â”‚
â”‚ Port 7001: Docker æ˜ å°„å…¥å£ âœ… FRP å®é™…å¯è¾¾              â”‚
â”‚                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Docker Container                                  â”‚ â”‚
â”‚ â”‚                                                   â”‚ â”‚
â”‚ â”‚ FRP Server ç›‘å¬: 0.0.0.0:7000                     â”‚ â”‚
â”‚ â”‚ Token: 2024                                       â”‚ â”‚
â”‚ â”‚                                                   â”‚ â”‚
â”‚ â”‚ ç«¯å£æ˜ å°„: 7001(å¤–éƒ¨) â†’ 7000(å†…éƒ¨)                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†‘
                â”‚ FRPè¿æ¥
                â”‚ å¿…é¡»ä½¿ç”¨: 10.91.1.207:7001
                â”‚ å¿…é¡»Token: 2024
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Android è®¾å¤‡  â”‚
        â”‚ frpc.ini      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥æœåŠ¡å™¨ç«¯å£
```bash
# åº”è¯¥çœ‹åˆ° 7001 åœ¨ç›‘å¬
netstat -an | grep 7001
```

### 2. æ£€æŸ¥ Docker æ—¥å¿—
```bash
docker compose logs phoneagent --tail 50 | grep -i frp
```

### 3. æµ‹è¯• FRP è¿æ¥ï¼ˆä»è®¾å¤‡ç«¯ï¼‰
```bash
# åœ¨è®¾å¤‡ä¸Šæ£€æŸ¥ç”Ÿæˆçš„é…ç½®
adb shell "run-as com.phoneagent.remote cat /data/user/0/com.phoneagent.remote/files/termux/home/.phoneagent/frpc.ini"

# é¢„æœŸè¾“å‡º:
# server_addr = 10.91.1.207
# server_port = 7001
# token = 2024
```

### 4. æŸ¥çœ‹ FRP å®¢æˆ·ç«¯æ—¥å¿—
```bash
adb shell "run-as com.phoneagent.remote tail -f /data/user/0/com.phoneagent.remote/files/termux/home/.phoneagent/frpc.log"

# æˆåŠŸè¾“å‡º:
# [I] login success

# å¤±è´¥è¾“å‡º:
# [W] connect to server error: connection write timeout
# [W] authorization failed
```

## ä¿®å¤åçš„å®Œæ•´æ£€æŸ¥æ¸…å•

- [x] docker-compose.yml: ç«¯å£æ˜ å°„ 7001:7000 âœ…
- [x] docker-healthcheck.sh: æ£€æŸ¥å®¿ä¸»æœº 7001 âœ…
- [x] docker-entrypoint.sh: æ˜¾ç¤ºæ­£ç¡®ç«¯å£ 7001 âœ…
- [x] FRP æœåŠ¡å™¨ç›‘å¬: å®¹å™¨å†… 7000 âœ…
- [x] Docker é‡å¯å®Œæˆ âœ…
- [ ] è®¾å¤‡ Token ä¿®æ”¹ä¸º 2024 â³ å¾…æ“ä½œ
- [ ] è®¾å¤‡é‡æ–°é…ç½® â³ å¾…æ“ä½œ
- [ ] FRP è¿æ¥æµ‹è¯• â³ å¾…éªŒè¯

## ä¸‹ä¸€æ­¥æ“ä½œ

1. **åœ¨ Android è®¾å¤‡ä¸Š:**
   - é‡æ–°æ‰“å¼€ PhoneAgent åº”ç”¨
   - å¡«å†™é…ç½®:
     - IP: 10.91.1.207
     - Token: **2024** (ä¸æ˜¯ 2014)
     - Remote Port: 6104
   - ç‚¹å‡»å®Œæˆ

2. **éªŒè¯è¿æ¥:**
   ```bash
   # æŸ¥çœ‹è®¾å¤‡ FRP æ—¥å¿—
   adb shell "run-as com.phoneagent.remote tail -30 /data/user/0/com.phoneagent.remote/files/termux/home/.phoneagent/frpc.log"
   ```

3. **å¦‚æœè¿˜æ˜¯å¤±è´¥:**
   - æ£€æŸ¥è®¾å¤‡å’ŒæœåŠ¡å™¨åœ¨åŒä¸€å±€åŸŸç½‘
   - æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 7001 ç«¯å£
   - æä¾›å®Œæ•´çš„ frpc.log æ—¥å¿—å†…å®¹

## æ€»ç»“

**å·²ä¿®å¤çš„é…ç½®é—®é¢˜:**
1. âœ… Docker ç«¯å£æ˜ å°„ä»é”™è¯¯çš„ 7001:7001 æ”¹å› 7001:7000
2. âœ… å¥åº·æ£€æŸ¥è„šæœ¬ç°åœ¨æ£€æŸ¥æ­£ç¡®çš„å¤–éƒ¨ç«¯å£ 7001
3. âœ… å¯åŠ¨ä¿¡æ¯æ˜¾ç¤ºæ­£ç¡®çš„ FRP ç«¯å£ 7001

**å…³é”®å‘ç°:**
- âš ï¸ **Token ä¸åŒ¹é…**: æœåŠ¡å™¨æ˜¯ 2024ï¼Œè®¾å¤‡å¡«çš„æ˜¯ 2014
- âœ… Docker é…ç½®ç°å·²æ­£ç¡®
- âœ… Android APK ConfigRepository é»˜è®¤å€¼å·²æ”¹ä¸º 7001

**éœ€è¦çš„æ“ä½œ:**
- ä¿®æ”¹è®¾å¤‡é…ç½®ä¸­çš„ Token ä¸º **2024**
- æˆ–è€…ä¿®æ”¹æœåŠ¡å™¨ .env æ–‡ä»¶ä¸­çš„ FRP_TOKEN ä¸º **2014**
